{extend name="common/common"} {block name="breadcrumbs"}
<ul class="breadcrumb">
    <li class="active">
        <i class="ace-icon fa fa-home home-icon"></i>
        <span _href="#">商户</span>
    </li>
    <li class="active">
        批量聚合码
    </li>
</ul>
<!-- #section:basics/content.searchbox -->
<div class="nav-search nav-position" id="nav-search">
    <form class="form-search form-inline">
        <span class="input-icon">
            <input type="text" placeholder="关键词" name="keyword" value="{:input('get.keyword')}" class="nav-search-input" autocomplete="off" />
            <i class="ace-icon fa fa-search nav-search-icon"></i>
        </span>
        <input type="submit" class="btn btn-info btn-xs " value="搜索">
        {if checkActionAuth('','view')}
        <a href="javascript:;" title="输入生成的数量，1~5000的整数" value="1000" ajax='{"data":"","url":"{:url('save')}","prompt":"text"}' class="btn btn-info btn-xs "><i class="glyphicon glyphicon-plus"></i>批量生成</a>
        {/if}
    </form>
</div>
{/block}
{block name="page-content"}
<div class="short-body">
<div class="alert alert-block alert-warning alert-body">
    聚合收款码：默认为空白码，<strong>需要使用APP绑定原收银账号方可使用</strong>；生成后，下载可批量印制；
</div>
<form action="" id="form2" method="POST">
    <table class="table table-striped table-bordered table-hover">
        <thead>
            <tr>
                <th><i class="ace-icon fa fa-clock-o bigger-110 hidden-480"></i>生成日期</th>
                <th width="151">数量</th>
                <th width="120">操作</th>
            </tr>
        </thead>
        {volist name="lists" id="vo"}
        <tr >
            <td>{$vo.short_url_addtime|date="Y-m-d H:i:s",###}</td>
            <td align="right">{$vo.counts} 个</td>
            <td>
                {if checkActionAuth('','add')}
                <a href="javascript:;" onclick="javascript:thisPage.downloadtable('{$vo.short_url_addtime}');">
                    <i class="ace-icon fa fa-download"></i>下载聚合码
                </a>
                {/if}
            </td>
        </tr>
        {/volist}
    </table>
</form>
<div class="pull-left ">
    
    <!-- <a onclick="doloadtable() " class="btn btn-white btn-inverse btn-sm " href="javascript:; ">
                                        导出表格
                                    </a> -->
</div>
<div class="pull-right ">
    <p style="text-align:right;">共{$lists->total()}条记录</p>
    {$lists->render()}
</div>
<div class="clearfix ">
</div>
<script type="text/javascript">
var thisPage = {
    downloadtable:function(thisaddtime){
        layer.load("请在生成二维码");
        $.ajax({
            url:"{:url('downloadqrcode')}",
            data:{"thisaddtime":thisaddtime},
            success:function(rs){
                layer.closeAll();
                if(rs.code==0)
                {
                    layer.alert(rs.message);
                }
                else
                {
                    window.location.href="{:url('downloadzip')}";
                }
                //window.open(rs.data.url);
            },
            error:function(){
                layer.closeAll();
                alert("错误");
            }
        })
    }
};
</script>
</div>
{/block}
