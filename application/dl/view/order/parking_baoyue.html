{extend name="common/common"} {block name="breadcrumbs"}
<ul class="breadcrumb">
    <li class="active">
        <i class="ace-icon fa fa-home home-icon"></i>
        <span _href="#">交易查询</span>
    </li>
    <li class="active">
        包月查询
    </li>
</ul>
{/block}
{block name="head"}
<script type="text/javascript" src="/static/common/js/bootstrapPaginator.js"></script>
{/block}
 {block name="page-content"}
<!-- PAGE CONTENT BEGINS -->
<!--bof list-->
<div class="order-body">
    <form class="form-search form-horizontal" id="searchfrom" action="javascript:thisCarMonth.doGetData(thisCarMonth.showlistpage);">
        <input type="hidden" id="page" name="page" value="1">
        <input type="hidden" name="pagesize" id="pagesize" value="10">
        <div class="row">
            <div class="col-xs-12">
                <div class="form-group col-sm-6">
                    <label class="col-sm-2 control-label">签约商户</label>
                    <div class="col-sm-10">
                        <select class="chosen-select" data="{:input('get.order_shop_id')}" name="order_shop_id" id="order_shop_id" onchange="thisCarMonth.shopchange(this.value,0)">
                            <option value="0">全部商户</option>
                            {volist name="shoplist" id="vo"}
                            <option value="{$vo.shop_id}">{$vo.shop_name}</option>
                            {/volist}
                        </select>
                        <br /><br />
                        店铺
                        <select data="{:input('get.order_store_id')}" name="order_store_id" id="order_store_id">
                            <option value="0">全部店铺</option>
                        </select> 
                    </div>
                </div>
                <div class="form-group col-sm-3">
                    <label class="col-sm-4 control-label">关键词</label>
                    <div class="col-sm-8">
                        <input name="keyword" type="text" placeholder="车牌号" class="nav-search-input col-sm-12" autocomplete="off" value="{:input('get.keyword')}" />
                    </div>
                    <br /><br />
                     <label class="col-sm-4 control-label">包月日期</label>
                    <div class="col-sm-8">
                        <div class="input-daterange input-group">
                            <input onFocus="WdatePicker({isShowClear:true,dateFmt:'yyyy-MM',alwaysUseStartDate:true});" placeholder="包月日期" title="包月日期" name="order_addtime_s" id="order_addtime_s" value="{:input('get.order_addtime_s')}" class="nav-search-input col-sm-12" type="text" />
                            <span class="input-group-addon">
                            <i class="fa glyphicon-minus"></i>
                        </div>
                    </div>
                </div>
                <div class="form-group col-sm-3">
                    <label class="col-sm-4 control-label"></label>
                    <div>
                        <button onclick="javascript:$('#pagesize').val(10);$('#page').val(0);" class="btn btn-inverse btn-sm"><i class="ace-icon fa fa-search nav-search-icon"></i>搜索</button>
                    </div>
                </div>
            </div>
        </div>
    </form>
    <div class="hr hr-12"></div>
<div class="col-xs-12">
    <div class="row">
        <table id="store_table" class="table table-striped table-bordered table-hover">
            <thead>
                <tr>
                    <th width="">记录ID</th>
                    <th width="">停车场名称</th>
                    <th width="">车牌号</th>                    
                    <th>包月费用</th>
                    <th width="">开始时间</th>
                    <th>结束时间</th>
                </tr>
            </thead>
            <tbody id="listpagebody">
            </tbody>          
        </table>
         <div class="pull-right ">
            <ul id="pagination" class="pagination"></ul>
        </div>
    </div>
</div>
<!--eof list-->
<div class="space-10"></div>
</div>
<script type="text/javascript">
    var thisCarMonth={
         //签约商户 的二级筛选
        shopchange: function(order_shop_id, order_store_id)
        {
            var url = "{:url('getstorelist?shop_id=qwerty')}";
            $.ajax(
            {
                url: url.replace("qwerty", order_shop_id),
                dateType: "json",
                success: function(data)
                {
                    var html = '<option value="0">全部店铺</option>';
                    if (data.length > 0)
                    {
                        data.forEach(function(obj)
                        {
                            html += '<option value="' + obj.store_id + '">' + obj.store_name + '</option>';
                        });
                    }
                    $("#order_store_id").html(html).val(order_store_id);
                }
            });
        },
        //获取数据
        doGetData: function(callBack)
        {
            thisCarMonth.showlistpageInit();
            var index = layer.load(1,
            {
                shade: [0.1, '#fff'] //0.1透明度的白色背景
            });
            $.ajax(
            {
                url: "{:url('carmonthlist')}",
                data: $("#searchfrom").serialize(),
                dataType: "json",
                success: function(rs)
                {
                    layer.close(index);
                    callBack && callBack(rs.data);
                    if(rs.code==0)
                    {
                        layer.alert(rs.message);
                    }
                },
                error: function()
                {
                    layer.close(index);
                }
            })
        },
        //列表页初始化
        showlistpageInit: function()
        {
            $("#listpagebody").html("");
            $("#box_tj").html('');
        },
        //列表页展示
        showlistpage: function(rs)
        {
            if (rs.total > 0)
            {
                var innertHTML = "";
                rs.data.forEach(function(one)
                {
                    innertHTML += "<tr>";
                    innertHTML += "<td>" + one.record_store_id + "</td>";
                    innertHTML += "<td>" + one.store_name + "</td>";
                    innertHTML += "<td>" + one.record_car_number_plate + "</td>";
                    innertHTML += "<td>" + one.record_parking_monthly_price + "</td>";
                    innertHTML += "<td>" + one.record_start_time + "</td>";
                    innertHTML += "<td>" + one.record_end_time + "</td>";
                    innertHTML += "</tr>";
                });
                $("#listpagebody").html(innertHTML);
                var options = {
                    currentPage: rs.current_page, //设置当前页，默认起始页为第一页
                    totalPages: Math.ceil(rs.total / rs.per_page), //总页数
                    numberOfPages: 5, //设置控件显示的页码数,跟后台计算出来的总页数没多大关系
                    bootstrapMajorVersion: 3, //如果是bootstrap3版本需要加此标识，并且设置包含分页内容的DOM元素为UL,如果是bootstrap2版本，则DOM包含元素是DIV
                    useBootstrapTooltip: 'true', //是否显示tip提示框
                    pageUrl: function(type, page, current)
                    {
                        return 'javascript:$("#page").val(' + page + ');$("#searchfrom").submit();' //为每个页码设置url访问请求链接，page为页码数
                    },
                    itemTexts: function(type, page, current)
                    { //文字翻译
                        switch (type)
                        {
                            case "first":
                                return "首页";
                            case "prev":
                                return "上一页";
                            case "next":
                                return "下一页";
                            case "last":
                                return "尾页";
                            case "page":
                                return page;
                        }
                    }
                }
                $('#pagination').bootstrapPaginator(options);
                $('#pagination').prepend("总" + rs.total + "条记录<br />");
            }
            else
            {
                $("#listpagebody").html("<tr><td colspan='8'>没有数据</td> </tr>");
                $('#pagination').html("");
                layer.msg("没有数据");
            }
        }
    }; 
    $(document).ready(function(){
        $("#searchfrom").submit();
    })
</script>
<!-- PAGE CONTENT ENDS -->
{/block}