<!DOCTYPE html><html>    <head>        <title>打赏 - {$store.store_name}</title>        <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />        <meta name="apple-mobile-web-app-capable" content="yes">        <meta name="apple-mobile-web-app-status-bar-style" content="black">        <meta content="telephone=no" name="format-detection" />        <meta content="email=no" name="format-detection" />        <style type="text/css">        * {            margin: 0;            padding: 0;            box-sizing: border-box;        }        body,        .content {            background: #515151;            font-size: 13px;        }        .paytour {            margin: 4.71rem 1.42rem 3.71rem;            border-radius: 1rem;            background: #ec4758;        }        .paytour .top {            background: url(/static/h5/image/bg-01.png) no-repeat -1rem 0;            background-size: 7.8rem;            border-radius: 1rem;            height: 7.8rem;        }        .paytour .img {            position: absolute;            left: 50%;            margin-top: -3.5rem;            margin-left: -3.5rem;            border-radius: 50%;            width: 7rem;            height: 7rem;            background: #FFFFFF;            overflow: hidden;        }        .paytour .img img {            position: absolute;            top: 50%;            left: 50%;            display: inline-block;            border-radius: 50%;            max-width: 100%;            transform: translate(-50%, -50%);            -webkit-transform: translate(-50%, -50%);        }        .tour-name {            position: absolute;            left: 50%;            top: 9rem;            transform: translateX(-50%);            -webkit-transform: translateX(-50%);            font-size: 1.28rem;            color: #FFFFFF;        }        .playtour-text {            padding: 4rem 0 8rem;            text-align: center;            font-size: 1.915rem;            color: #FFFFFF;        }        .btns-moeny {            padding: 0 2.6rem;            padding-top: 9.04rem;            padding-bottom: 6.89rem;            overflow: hidden;        }        .btns-moeny span {            display: block;            float: left;            margin: 0 2.6%;            border: 1px solid #f2bc76;            border-radius: 0.385rem;            height: 3.21rem;            width: 28%;            line-height: 3.21rem;            font-size: 1.24rem;            text-align: center;            color: #FFFFFF;        }        .btns-moeny span.check-on {            background: #f2bc76;            color: #ec4758;        }        .tour-input {            position: relative;            margin: 0 3.52rem;            margin-bottom: 3rem;            border-bottom: 1px solid #FFFFFF;            height: 4.2rem;        }        .tour-input strong {            position: absolute;            top: 0.65rem;            font-size: 1.28rem;            color: #FFFFFF;        }        .tour-input input {            padding: 0 0.5rem;            width: 100%;            height: 3.2rem;            outline: none;            background: none;            border: none;            font-size: 1.43rem;            text-align: right;            color: #FFFFFF;        }        .tour-submit {            margin: 0 3.52rem;        }        .tour-submit button {            margin-bottom: 2.13rem;            border: 1px solid #f2bc76;            border-radius: 0.385rem;            background: #f2bc76;            outline: none;            height: 3.26rem;            width: 100%;            font-size: 1.18rem;            color: #ec4758;        }        </style>        <script type="text/javascript">        window.jQuery || document.write("<script src='/static/dl/assets/js/jquery.js'>" + "<" + "/script>");        function thisuserAgent()        {            var userAgent = navigator.userAgent.toLowerCase();            if (userAgent.match(/micromessenger/i) == "micromessenger")            {                return "jsapi_wxpay";            }            else if (userAgent.match(/alipayclient/i) == "alipayclient")            {                return "jsapi_alipay";            }            else            {                return false;            }        }        switch (thisuserAgent())        {            case "jsapi_alipay":                document.write('<script type="text/javascript" src="https://a.alipayobjects.com/g/h5-lib/alipayjsapi/3.0.5/alipayjsapi.inc.min.js"><\/script>');                break;            case "jsapi_wxpay":                document.write('<link rel="stylesheet" type="text/css" href="//res.wx.qq.com/open/libs/weui/1.1.2/weui.min.css">');                break;        }        </script>    </head>    <body>        <form method="get" action="javascript:thisApp.createOrder();">            <input min="0.01" value="0" max="9999999" id="total_amount" name="total_amount" type="hidden" placeholder="0元" step="0.01" />            <input type="hidden" name="guest_brief" id="guest_brief" placeholder="打赏" />            <div class="content">                <div class="paytour">                    <div class="top">                        <span class="img"><img src="/static/h5/image/s.png"/></span>                        <span class="tour-name" id="realname">{$realname}</span>                    </div>                    <div class="btns-moeny">                        {volist name="rewardList" id="vo"} {eq name="vo.reward_is_default" value="1"}                        <span class="check-on" onclick="javascript:thisApp.selectNav(this,{$vo.reward_cash});">{$vo.reward_cash|floatval}元</span>                        <script type="text/javascript">                        document.querySelector("#total_amount").value = {$vo.reward_cash|floatval};                        </script>                        {else/}                        <span onclick="javascript:thisApp.selectNav(this,{$vo.reward_cash});">{$vo.reward_cash|floatval}元</span> {/eq} {/volist}                    </div>                    <!--其它金额-->                    <!--<div class="tour-input"><strong>其它金额</strong><input type="number" id="total_amount" step="0.01"/></div>-->                    <div class="tour-submit">                        <button type="submit">打赏你</button>                    </div>                </div>            </div>        </form>    </body>    <script type="text/javascript">    document.querySelector('html').style.fontSize = document.body.clientWidth / 28.42 + "px";    var thisApp = {        selectNav: function(context, num)        {            var isActive = context.classList.contains('check-on'),                isCheck;            if (isActive)            {                context.classList.remove('check-on');                document.querySelector("#total_amount").value = num;            }            else            {                isCheck = document.querySelector('.check-on');                if (isCheck)                {                    isCheck.classList.remove('check-on');                };                context.classList.add('check-on');                document.querySelector("#total_amount").value = num;            };        },        createOrder: function()        {            switch (thisuserAgent())            {                case "jsapi_alipay": //                    ap.showLoading(                    {                        content: '发起支付宝支付',                    });                    $.ajax(                    {                        "url": "/index.php?s=api/pay/jsapipayrequest",                        "data":                        {                            subject: "给" + $("#realname").html() + "打赏",                            buyer_id: "{$buyer_open_id}",                            user_id: "{:input('user_id')}",                            total_amount: $("#total_amount").val(),                            guest_brief: $("#guest_brief").val(),                        },                        "type": "post",                        "dataType": "json",                        "success": function(rs)                        {                            ap.hideLoading();                            //根据支付返回的状态，不同处理                            if (rs.code)                            {                                thisApp.jsapi_alipay_pay(rs.data.trade_no); //唤起收银台JSAPI                            }                            else                            {                                ap.alert(                                {                                    title: '错误',                                    content: rs.message,                                    buttonText: '我知道了'                                }, function() {                                });                            }                        },                        error: function(rs)                        {                            ap.hideLoading();                            alert(JSON.stringify(rs));                        }                    });                    break;                case "jsapi_wxpay":                    var loadingToast = function(message)                    {                        $("#loadingToast").remove();                        message && $("body").append($('<div id="loadingToast"><div class="weui-mask_transparent"></div><div class="weui-toast"><i class="weui-loading weui-icon_toast"></i><p class="weui-toast__content">' + message + '</p></div></div>'));                    }                    loadingToast("发起微信支付");                    $.ajax(                    {                        "url": "/index.php?s=api/pay/jsapipayrequest",                        "data":                        {                            subject: "给" + $("#realname").html() + "打赏",                            buyer_id: "{$buyer_open_id}",                            user_id: "{:input('user_id')}",                            total_amount: $("#total_amount").val(),                            guest_brief: $("#guest_brief").val(),                        },                        "type": "post",                        "dataType": "json",                        "success": function(rs)                        {                            loadingToast();                            //根据支付返回的状态，不同处理                            if (rs.code)                            {                                thisApp.jsapi_wxpay_pay(rs.data); //唤起收银台JSAPI                            }                            else                            {                                alert(rs.message);                            }                        },                        error: function(rs)                        {                            loadingToast();                            alert(JSON.stringify(rs));                        }                    });                    break;                default:                    alert("未处理的提交订单");            }        },        jsapi_alipay_pay: function(tradeNO)        {            //alert(datajson);            // 通过传入交易号唤起快捷调用方式(注意tradeNO大小写严格)            AlipayJSBridge.call("tradePay",            {                tradeNO: tradeNO            }, function(data)            {                ap.hideLoading();                switch (data.resultCode)                {                    case "9000":                        ap.alert(                        {                            title: '完成',                            content: "支付成功",                            buttonText: '我知道了'                        }, function() {                        });                        //location.href=data.callbackUrl;                        break;                    case "8000":                        ap.alert(                        {                            title: '提醒',                            content: "订单正在处理中",                            buttonText: '我知道了'                        }, function() {                        });                        //location.href=data.callbackUrl;                        break;                    default:                        ap.alert(                        {                            title: '提醒',                            content: "支付已取消",                            buttonText: '我知道了'                        }, function() {                        });                }            });        },        jsapi_wxpay_pay: function(getBrandWCPayRequestParam)        {            getBrandWCPayRequestParam = (typeof getBrandWCPayRequestParam == "string") ? JSON.parse(getBrandWCPayRequestParam) : getBrandWCPayRequestParam;            WeixinJSBridge.invoke('getBrandWCPayRequest', getBrandWCPayRequestParam, function(res)            {                if (res.err_msg == "get_brand_wcpay_request:ok")                {                    alert("支付完成");                    // 使用以上方式判断前端返回,微信团队郑重提示：res.err_msg将在用户支付成功后返回    ok，但并不保证它绝对可靠。                   }                else                {                    alert("支付已取消");                }            });        }    }    </script></html>