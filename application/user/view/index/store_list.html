{extend name="common/common"} {block name="breadcrumbs"}
<ul class="breadcrumb">

	<li class="active">
		<i class="ace-icon fa fa-home home-icon"></i>
		<span _href="#">经营场地信息</span>
	</li>
	<li class="active">
		所有经营场地
	</li>
</ul>
<div class="nav-search nav-positions" id="nav-search">
	<a href="#" class="btn btn-info btn-xs" id="btn-add"><i class="glyphicon glyphicon-plus"></i>新增</a>
</div>
{/block} {block name="page-content"}
<script type="text/javascript">
	$(function(){
		check_login();
		/*alert(store_name);*/
		$("#store-name").html(store_name);
		$("#user-name").html(user_realname);
		$("#log-off").on('click',function(){
			clear_cookie();
			$(location).attr('href', common_url+'/user/index/login');
		});
	});
</script>
<!-- PAGE CONTENT BEGINS -->
<!--bof list-->
<div class="storelist-body">
<div class="col-xs-12">
	<div class="row">
		<table id="store_table" class="table table-striped table-bordered table-hover">
			<thead>
				<tr>
					<th width="">经营场地名称</th>
					<th width="">地址</th>
					<th width="">经营场地电话</th>
					<th>打赏功能</th>
					<th>广告位</th>
					<th width="">操作</th>
				</tr>
			</thead>
			<tbody>
			</tbody>			
		</table>
	</div>
</div>
<!--eof list-->
<div class="space-10"></div>
<script type="text/javascript">
	$(function() {		        
        var microtime=Date.parse(new Date())/1000;
        get_store_list();
      	//bof 获取订单列表数据方法
		function get_store_list()
		{
			var postParam = {
				user_id: user_id,
				version: 1,
				time: microtime
			};
			var sign= getsign(postParam);
			postParam.sign = sign; //不这么传值下，有错误
			$.ajax(
				{
					type: "post",
					url: common_url+ "/api/store/getstorelist",
					data: postParam,
					dataType: 'json',
					success: function(res)
					{
						if(res.code == 1)
						{
							$('#store_table>tbody').html('');
							if(res.data)
							{
								res.data.list.forEach(function(item)
									{
										var html = '<tr id="' + item.store_id + '">' +											
											'<td>' + item.store_name + '</td>' +
											'<td class="order-status">' + item.store_address + '</td>' +
											'<td>' + item.store_mobile + '</td>';
											if(item.store_open_reward>0){
												html+='<td>已开启</td>';
											}else{
												html+='<td>已关闭</td>';
											}
											if(item.store_pay_after_ad_active){
												html+='<td>已开启</td>';
											}else{
												html+='<td>已关闭</td>';
											}
											html += '<td><div class="btn-group"><a data-id="' + item.store_id + '" class="btn btn-xs btn-success btn-detail" href="store_detail/store_id/'+item.store_id +'">详情</a><a data-id="' + item.store_id + '" class="btn btn-xs btn-success btn-detail btn-del" href="#">删除</a>';
										html += '</div></td>' +
											'</tr>';
										$('#store_table>tbody').append(html);
										//var html=thisFrontApp.getordertemplate(item,'order');
										//$('.order-nearly').append(html);
									});
							}
						} else
						{
							alert(res.message);
						}
					}

				});

		}
        $("#store_table").on("click",'.btn-del',function(){
        	var store_id=$(this).data("id");
        	var postParam = {
				user_id: user_id,
				store_id:store_id,
				version: 1,
				time: microtime
			};
			var sign= getsign(postParam);
			postParam.sign = sign; //不这么传值下，有错误
			$.ajax({
				type:"post",
				url:"{:url('api/store/deletestoreone')}",
				data:postParam,
				async:true,
				dataType:"json",
				success:function(res){
					if(res.code>0){
						alert(res.message);
						$(location).attr('href', common_url+'/user/index/store_list');
					}else{
						alert(res.message);
					}
				}				
			});
        });  
        $("#btn-add").on("click",function(){
        	var postParam = {
				user_id: user_id,
				version: 1,
				time: microtime
			};
			var sign= getsign(postParam);
			postParam.sign = sign; //不这么传值下，有错误
			$.ajax({
				type:"post",
				url:"{:url('api/store/storeaddone')}",
				data:postParam,
				async:true,
				dataType:"json",
				success:function(res){
					if(res.code>0){
						$(location).attr('href', common_url+'/user/index/store_add');
					}else{
						alert(res.message);
					}
				}				
			});
        })
	});
</script>
<!-- PAGE CONTENT ENDS -->
{/block}