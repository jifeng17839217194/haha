{extend name="common/common"} {block name="breadcrumbs"}
<ul class="breadcrumb">
    <li class="active">
        <i class="ace-icon fa fa-home home-icon"></i>
        <span _href="#">优惠券</span>
    </li>
    <li class="active">
        管理
    </li>
</ul>
<!-- #section:basics/content.searchbox -->
{/block}
{block name="head"}
<script type="text/javascript">
	$(function(){
		check_login();
		/*alert(store_name);*/
		$("#store-name").html(store_name);
		$("#user-name").html(user_realname);		
		$("#log-off").on('click',function(){
			clear_cookie();
			$(location).attr('href', common_url+'/user/index/login');
		});
	});
</script>
{/block}
{block name="page-content"}
	<div class="form-horizontal">
		<div class="widget-box">
			<div class="widget-header widget-header-flat">
				<h4 class="widget-title smaller">按时间</h4>
			</div>
			<div class="widget-body">
				<div class="widget-main">
					<div class="form-group">
						<label class="col-sm-2 control-label no-padding-right">免费停车时间：</label>
					    <div class="col-sm-10">
					        <input type="text" placeholder="" pattern="*" name="coupon_hours" value="" title="免费停车时间" id="coupon_hours" class="col-xs-10 col-sm-5">				       
					    </div>
					</div>
					<div class="form-group">
						<label class="col-sm-2 control-label no-padding-right">生成张数：</label>
					    <div class="col-sm-10">
					        <input type="text" placeholder="" pattern="*" name="coupon_time_num" value="" title="生成张数：" id="coupon_time_num" class="col-xs-10 col-sm-5">				       
					    </div>
					</div>		
					<div class="clearfix form-actions">
				        <div class="col-md-offset-3 col-md-9">
				            <button class="btn btn-info" id="time_btn" type="button">
				                <i class="ace-icon fa fa-check bigger-110"></i> 保存
				            </button>
				        </div>
				    </div>	
			    </div>	
			</div>
		</div>
		<div class="widget-box">
			<div class="widget-header widget-header-flat">
				<h4 class="widget-title smaller">按费用</h4>
			</div>
			<div class="widget-body">
				<div class="widget-main">
					<div class="form-group">
						<label class="col-sm-2 control-label no-padding-right">免费金额：</label>
					    <div class="col-sm-10">
					        <input type="text" placeholder="" pattern="*" name="coupon_money" value="" title="免费金额：" id="coupon_money" class="col-xs-10 col-sm-5">				       
					    </div>
					</div>
					<div class="form-group">
						<label class="col-sm-2 control-label no-padding-right">生成张数：</label>
					    <div class="col-sm-10">
					        <input type="text" placeholder="" pattern="*" name="coupon_money_num" value="" title="生成张数：" id="coupon_money_num" class="col-xs-10 col-sm-5">				       
					    </div>
					</div>		
					<div class="clearfix form-actions">
				        <div class="col-md-offset-3 col-md-9">
				            <button class="btn btn-info" id="money_btn" type="button">
				                <i class="ace-icon fa fa-check bigger-110"></i> 保存
				            </button>
				        </div>
				    </div>	
			    </div>	
			</div>
		</div>
	</div>
<script type="text/javascript">
	$(function(){
		var microtime=Date.parse(new Date())/1000;   	
		$("#time_btn").click(function(){
			var coupon_hours=$("#coupon_hours").val();
			var coupon_num=$("#coupon_time_num").val();			
			if(coupon_hours==''||coupon_num==''){
				alert("提交数据不能为空！");return;
			}
			var postParam = {
                user_id: user_id,
                coupon_hours: coupon_hours,
                coupon_num: coupon_num,
                coupon_type:0,
                version:1,
                time:microtime
            };
            var sign = getsign(postParam);
            postParam.sign = sign; //不这么传值下，有错误
			$.ajax({
				type:"post",
				url:"{:url('api/coupon/coupon_create')}",
				data:postParam,
				dataType:"json",
				async:true,
/*				beforeSend: function(){
			     	layer.load('生成中·····');
			    },*/
				success:function(res){
					if(res.code==1){
						alert(res.message);
						$(location).attr('href', common_url+'/user/index/coupon_index');
					}else{
						alert(res.message);
					}
				}
			});
		});
		$("#money_btn").click(function(){
			var coupon_money=$("#coupon_money").val();
			var coupon_num=$("#coupon_money_num").val();			
			if(coupon_num==''||coupon_money==''){
				alert("提交数据不能为空！");return;
			}
			var postParam = {
                user_id: user_id,
                coupon_money:coupon_money ,
                coupon_num: coupon_num,
                coupon_type:0,
                version:1,
                time:microtime
            };
            var sign = getsign(postParam);
            postParam.sign = sign; //不这么传值下，有错误
			$.ajax({
				type:"post",
				url:"{:url('api/coupon/coupon_create')}",
				data:postParam,
				dataType:"json",
				async:true,
/*				beforeSend: function(){
			     	layer.load('生成中·····');
			    },*/
				success:function(res){
					if(res.code==1){
						alert(res.message);
						$(location).attr('href', common_url+'/user/index/coupon_index');
					}else{
						alert(res.message);
					}
				}
			});
		});
	})
</script>	
{/block}